# V3 åŠ¨æ€å¥–åŠ±è¯¾ç¨‹ç³»ç»Ÿ - å®ç°æ€»ç»“

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### 1. ç¯å¢ƒä¿®æ”¹ (`gym_snake_env_v3.py`)

#### 1.1 `__init__` æ–¹æ³•
- âœ… æ–°å¢ `stage: int = 1` å‚æ•°
- âœ… æ·»åŠ  `self.stage = stage`
- âœ… æ·»åŠ  `self.hunger_timer = 0`
- âœ… æ·»åŠ  `self.hunger_limit = self.board_size * self.board_size`

#### 1.2 `reset` æ–¹æ³•
- âœ… æ–°å¢ `stage: Optional[int] = None` å‚æ•°
- âœ… æ”¯æŒåŠ¨æ€åˆ‡æ¢ stage
- âœ… é‡ç½® `self.hunger_timer = 0`
- âœ… æ›´æ–° `self.hunger_limit` å½“ stage æ”¹å˜æ—¶

#### 1.3 `step` æ–¹æ³•
- âœ… æ¯æ­¥å¢åŠ  `self.hunger_timer += 1`
- âœ… åƒåˆ°é£Ÿç‰©æ—¶é‡ç½® `self.hunger_timer = 0`

#### 1.4 `_calculate_reward_v3()` å‡½æ•°ï¼ˆæ ¸å¿ƒï¼‰
- âœ… å®ç° Stage 1-4 åŠ¨æ€å¥–åŠ±ç³»æ•°è¡¨
- âœ… Stage 1 (6x6): ä¿å®ˆç­–ç•¥
  - é è¿‘é£Ÿç‰©: +0.3, è¿œç¦»: -0.2, ç”Ÿå­˜: +0.2
  - è¾¹ç¼˜å¥–åŠ±: +0.3, ä¸­å¿ƒå¼€æ”¾: +0.0
  - é™·é˜±: -1.5, æ’å¢™: -10.0
  - é¥¥é¥¿è®¡æ—¶å™¨: å…³é—­

- âœ… Stage 2 (8x8): ç§¯æç­–ç•¥
  - é è¿‘é£Ÿç‰©: +1.0, è¿œç¦»: -0.5, ç”Ÿå­˜: +0.1
  - è¾¹ç¼˜å¥–åŠ±: +0.0ï¼ˆå…³é—­ï¼‰, ä¸­å¿ƒå¼€æ”¾: +0.5
  - é™·é˜±: -3.0, æ’å¢™: -20.0
  - é¥¥é¥¿è®¡æ—¶å™¨: å¯åŠ¨ï¼ˆ-10.0 æƒ©ç½šï¼‰

- âœ… Stage 3 (10x10): è¿›é˜¶ç­–ç•¥
  - é è¿‘é£Ÿç‰©: +1.0, è¿œç¦»: -0.5, ç”Ÿå­˜: +0.1
  - è¾¹ç¼˜å¥–åŠ±: +0.0ï¼ˆå…³é—­ï¼‰, ä¸­å¿ƒå¼€æ”¾: +1.0
  - é™·é˜±: -5.0, æ’å¢™: -20.0
  - é¥¥é¥¿è®¡æ—¶å™¨: å¯åŠ¨ï¼ˆ-10.0 æƒ©ç½šï¼‰

- âœ… Stage 4 (12x12): å¤§å¸ˆç­–ç•¥
  - é è¿‘é£Ÿç‰©: +0.5, è¿œç¦»: -0.3, ç”Ÿå­˜: +0.2
  - è¾¹ç¼˜å¥–åŠ±: +0.0ï¼ˆå…³é—­ï¼‰, ä¸­å¿ƒå¼€æ”¾: +1.0
  - é™·é˜±: -5.0, æ’å¢™: -20.0
  - é¥¥é¥¿è®¡æ—¶å™¨: å¯åŠ¨ï¼ˆ-10.0 æƒ©ç½šï¼‰

#### 1.5 é¥¥é¥¿è®¡æ—¶å™¨æœºåˆ¶
- âœ… ä»…åœ¨ Stage 2+ å¯åŠ¨
- âœ… æ¯æ­¥ç´¯åŠ  `hunger_timer`
- âœ… è¶…è¿‡ `hunger_limit` (board_sizeÂ²) æ—¶ç»™äºˆ -10.0 æƒ©ç½š
- âœ… æƒ©ç½šåè‡ªåŠ¨é‡ç½®è®¡æ—¶å™¨

#### 1.6 è¾…åŠ©å‡½æ•°
- âœ… æ–°å¢ `_is_wall_collision()` å‡½æ•°ç”¨äºåŒºåˆ†æ’å¢™å’Œæ’èº«ä½“

---

### 2. è®­ç»ƒè„šæœ¬ä¿®æ”¹ (`snake_ai_ppo_v3.py`)

#### 2.1 `create_v3_model()` å‡½æ•°
- âœ… æ–°å¢ `stage: int = 1` å‚æ•°
- âœ… ä¼ é€’ `stage` å‚æ•°ç»™ç¯å¢ƒåˆ›å»º
- âœ… è‡ªåŠ¨è®¾ç½® `curriculum_stage` (å‘åå…¼å®¹)

#### 2.2 `train_curriculum()` å‡½æ•°
- âœ… å®ç°åŠ¨æ€ç¯å¢ƒåˆ‡æ¢
- âœ… å½“ä»å‰ä¸€é˜¶æ®µè¿ç§»æ—¶ï¼Œä¼ å…¥æ­£ç¡®çš„ `stage` å‚æ•°

#### 2.3 å‚æ•°éœ‡è¡ (Hyperparameter Shock)
- âœ… å®ç°ç­–ç•¥ A: å­¦ä¹ ç‡éœ‡è¡
  - æ­¥éª¤ 1: è®¾ç½® LR = 3e-4ï¼Œè®­ç»ƒ 100,000 æ­¥
  - æ­¥éª¤ 2: æ¢å¤åŸå§‹ LRï¼Œç»§ç»­å‰©ä½™è®­ç»ƒ
- âœ… ä»…åœ¨ä»å‰ä¸€é˜¶æ®µè¿ç§»æ—¶å¯åŠ¨
- âœ… ç¬¬ä¸€é˜¶æ®µä»å¤´å¼€å§‹è®­ç»ƒï¼ˆæ— éœ‡è¡ï¼‰

#### 2.4 è¯„ä¼°å’Œæ¼”ç¤ºå‡½æ•°
- âœ… `_evaluate_agent()`: ä¼ é€’æ­£ç¡®çš„ `stage` å‚æ•°
- âœ… `evaluate_model()`: æ–°å¢ `stage` å‚æ•°
- âœ… `demo_stage()`: æ ¹æ® stage_idx è®¾ç½®æ­£ç¡®çš„ stage
- âœ… `main()`: æ›´æ–° eval æ¨¡å¼ä»¥ä¼ é€’ stage

---

## ğŸ“Š æµ‹è¯•ç»“æœ

æµ‹è¯•è„šæœ¬ `test_dynamic_rewards_v3.py` æˆåŠŸéªŒè¯ï¼š

âœ… **Stage 1-4 ç¯å¢ƒåˆ›å»º**
- æ‰€æœ‰ stage éƒ½èƒ½æ­£ç¡®åˆå§‹åŒ–
- hunger_limit æ­£ç¡®è®¾ç½®ï¼ˆ36, 64, 100, 144ï¼‰

âœ… **åŠ¨æ€ Stage åˆ‡æ¢**
- `reset(stage=N)` æˆåŠŸåˆ‡æ¢ stage
- hunger_timer æ­£ç¡®é‡ç½®

âœ… **é¥¥é¥¿è®¡æ—¶å™¨**
- æ¯æ­¥æ­£ç¡®ç´¯åŠ 
- åƒåˆ°é£Ÿç‰©åé‡ç½®

---

## ğŸ¯ å…³é”®æ”¹è¿›ç‚¹

### 1. æ¸è¿›å¼éš¾åº¦è°ƒæ•´
- **Stage 1**: å­¦ä¹ åŸºç¡€ï¼ˆè¾¹ç¼˜ç­–ç•¥ï¼Œè€å¿ƒï¼‰
- **Stage 2**: å¼•å…¥ç´§è¿«æ„Ÿï¼ˆé«˜å¥–åŠ±/æƒ©ç½šï¼Œé¥¥é¥¿è®¡æ—¶å™¨ï¼‰
- **Stage 3**: ç©ºé—´ç®¡ç†ï¼ˆæ›´å¼ºçš„ä¸­å¿ƒå¥–åŠ±ï¼‰
- **Stage 4**: å¹³è¡¡ç­–ç•¥ï¼ˆé™ä½ç´§è¿«æ„Ÿï¼Œæé«˜ç”Ÿå­˜ä»·å€¼ï¼‰

### 2. å‚æ•°éœ‡è¡æœºåˆ¶
- æ‰“ç ´ Stage 1 çš„ä¿å®ˆç­–ç•¥
- å¼ºåˆ¶æ¢ç´¢æ–°ç­–ç•¥
- é¿å…è¿‡åº¦æ“¬åˆ

### 3. é¥¥é¥¿è®¡æ—¶å™¨
- Stage 2+ å¼ºåˆ¶ AI ä¸»åŠ¨å¯»é£Ÿ
- é˜²æ­¢æ— é™å¾ªç¯è¾¹ç¼˜ç§»åŠ¨
- æƒ©ç½šå€¼ -10.0ï¼ˆè¶³å¤Ÿå¼ºä½†ä¸è‡´å‘½ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. **è¿è¡Œå®Œæ•´è®­ç»ƒ**
   ```bash
   python snake_ai_ppo_v3.py --mode train
   ```

2. **è§‚å¯Ÿå…³é”®æŒ‡æ ‡**
   - Stage 1: edge_ratio åº”è¯¥è¾ƒé«˜ï¼ˆ>50%ï¼‰
   - Stage 2: edge_ratio åº”è¯¥é™ä½ï¼ˆ<30%ï¼‰
   - åˆ†æ•°åº”è¯¥é€æ­¥æé«˜

3. **è¯„ä¼°å„é˜¶æ®µ**
   ```bash
   python snake_ai_ppo_v3.py --mode eval --stage 0  # Stage 1
   python snake_ai_ppo_v3.py --mode eval --stage 1  # Stage 2
   ```

---

## ğŸ“ å…¼å®¹æ€§è¯´æ˜

âœ… **å‘åå…¼å®¹**
- ä¿ç•™ `curriculum_stage` å‚æ•°ï¼ˆ"conservative"/"aggressive"ï¼‰
- ç°æœ‰ä»£ç å¯ä»¥ç»§ç»­ä½¿ç”¨æ—§å‚æ•°
- æ–°ä»£ç ä½¿ç”¨ `stage=1-4` å‚æ•°è·å¾—æ›´ç²¾ç»†çš„æ§åˆ¶

âœ… **å¹³æ»‘è¿‡æ¸¡**
- Stage 1 = Conservative
- Stage 2-4 = Aggressive
- åŠ¨æ€å¥–åŠ±ç³»æ•°è¡¨æä¾›æ›´ç»†è‡´çš„è°ƒæ•´

---

æ›´æ–°æ—¶é—´: 2025-10-26
ç‰ˆæœ¬: V3 with Dynamic Rewards (Stage 1-4)
